<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ç»ƒä¹ ç»“æœ - æ¯æ—¥ä½œä¸š</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
    <div class="container">
        <div class="card">
            <div class="result-header">
                {% if result.accuracy >= 90 %}
                <div class="result-emoji">ğŸ‰</div>
                <div class="result-title">å¤ªæ£’äº†ï¼</div>
                <div class="result-message">ä½ çœŸæ˜¯ä¸ªå°å¤©æ‰ï¼</div>
                {% elif result.accuracy >= 70 %}
                <div class="result-emoji">ğŸ‘</div>
                <div class="result-title">åšå¾—ä¸é”™ï¼</div>
                <div class="result-message">ç»§ç»­åŠ æ²¹å“¦ï¼</div>
                {% else %}
                <div class="result-emoji">ğŸ’ª</div>
                <div class="result-title">ç»§ç»­åŠªåŠ›ï¼</div>
                <div class="result-message">å¤šç»ƒä¹ å°±ä¼šè¿›æ­¥çš„ï¼</div>
                {% endif %}
            </div>

            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value">{{ result.duration_display }}</div>
                    <div class="stat-label">â±ï¸ ç”¨æ—¶</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">{{ result.correct }}</div>
                    <div class="stat-label">âœ… æ­£ç¡®</div>
                </div>
                <div class="stat-item wrong">
                    <div class="stat-value">{{ result.wrong }}</div>
                    <div class="stat-label">âŒ é”™è¯¯</div>
                </div>
                <div class="stat-item accuracy">
                    <div class="stat-value">{{ result.accuracy }}%</div>
                    <div class="stat-label">ğŸ“Š æ­£ç¡®ç‡</div>
                </div>
            </div>

            {% if result.wrong_questions %}
            <div class="wrong-section">
                <h2 class="section-title">ğŸ“ é”™é¢˜è®¢æ­£</h2>
                <p style="color: #718096; margin-bottom: 20px;">è¯·æŠŠä¸‹é¢çš„é”™é¢˜é‡æ–°åšä¸€éï¼Œå…¨éƒ¨è®¢æ­£æ­£ç¡®åæ‰èƒ½è¿”å›ä¸»é¡µå“¦ï¼</p>

                <form id="correctionForm" action="{{ url_for('math_correct') }}" method="POST">
                    <input type="hidden" name="practice_id" value="{{ result.practice_id }}">

                    {% for q in result.wrong_questions %}
                    <div class="wrong-item" data-question="{{ q.id }}">
                        <div class="question-number">{{ q.id }}</div>
                        <div class="question-content">
                            <span class="question-text">{{ q.display }}</span>
                            <input type="number" name="correction_{{ q.id }}" class="correction-input"
                                inputmode="numeric" pattern="[0-9]*" autocomplete="off"
                                data-correct="{{ q.correct_answer }}" required>
                        </div>
                        <div class="wrong-answer">
                            <span class="your-answer">{{ q.user_answer }}</span>
                            <span style="color: #718096; font-size: 0.9rem;">ä½ çš„ç­”æ¡ˆ</span>
                        </div>
                    </div>
                    {% endfor %}

                    <div class="button-group">
                        <button type="submit" class="btn btn-success btn-block" id="correctBtn">
                            âœï¸ æäº¤è®¢æ­£
                        </button>
                    </div>
                </form>
            </div>
            {% else %}
            <div class="message message-success">
                ğŸŒŸ å…¨éƒ¨æ­£ç¡®ï¼Œæ²¡æœ‰é”™é¢˜ï¼
            </div>
            <div class="button-group">
                <a href="{{ url_for('index') }}" class="btn btn-primary">ğŸ  è¿”å›ä¸»é¡µ</a>
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        // è®¢æ­£è¾“å…¥éªŒè¯
        const correctionInputs = document.querySelectorAll('.correction-input');

        correctionInputs.forEach(input => {
            input.addEventListener('input', function () {
                const correctAnswer = parseInt(this.dataset.correct);
                const userAnswer = parseInt(this.value);

                if (this.value.trim() !== '') {
                    if (userAnswer === correctAnswer) {
                        this.classList.remove('wrong');
                        this.classList.add('correct');
                    } else {
                        this.classList.remove('correct');
                    }
                }
            });

            // æŒ‰å›è½¦é”®è·³åˆ°ä¸‹ä¸€é¢˜
            input.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const currentIndex = Array.from(correctionInputs).indexOf(this);
                    if (currentIndex < correctionInputs.length - 1) {
                        correctionInputs[currentIndex + 1].focus();
                    }
                }
            });
        });

        // è¡¨å•æäº¤
        const form = document.getElementById('correctionForm');
        if (form) {
            form.addEventListener('submit', function (e) {
                let allFilled = true;
                correctionInputs.forEach(input => {
                    if (input.value.trim() === '') {
                        allFilled = false;
                        input.focus();
                    }
                });

                if (!allFilled) {
                    e.preventDefault();
                    alert('è¯·å®Œæˆæ‰€æœ‰è®¢æ­£é¢˜ç›®ï¼');
                    return false;
                }
            });

            // è‡ªåŠ¨èšç„¦ç¬¬ä¸€ä¸ªè®¢æ­£è¾“å…¥æ¡†
            if (correctionInputs.length > 0) {
                correctionInputs[0].focus();
            }
        }
    </script>
</body>

</html>